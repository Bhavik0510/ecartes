<?xml version="1.0" encoding="utf-8"?>
<odoo>
<template id="purchase.report_purchaseorder_document">
    <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)"/>
    <t t-set="company_id_val" t-value="o.company_id"/>
    <t t-call="ecartes_report.custom_external_layout_header_po">
        <!-- <t t-set="address">
            <div t-field="o.partner_id"
            t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True, "phone_icons": True}'/>
            <p t-if="o.partner_id.vat"><t t-esc="o.company_id.account_fiscal_country_id.vat_label or 'Tax ID'"/>: <span t-field="o.partner_id.vat"/></p>
        </t> -->
        <div class="d-none">
            <t t-if="o.dest_address_id">
                <t t-set="information_block">
                    <strong>Shipping address:</strong>
                    <div t-if="o.dest_address_id">
                        <div t-field="o.dest_address_id"
                            t-options='{"widget": "contact", "fields": ["address", "name", "phone"], "no_marker": True, "phone_icons": True}' name="purchase_shipping_address"/>
                    </div>

                </t>
            </t>
        </div>
        <div class="page">
            <div class="row">
                <div class="col-7 text-left mb4">
                    <strong>DATE: </strong><span t-field="o.date_order"/>
                </div>
                <div class="col-5" style="display:flex;align-items:center; justify-content:right;">
                    <div>Ref No: <t t-esc="o.name"/></div>
                </div>
            </div>
            <div class="mb-1" style="width:100%;float:left;font-weight:bold;text-align:center;font-size:24px;text-decoration: underline;margin-top:40px;">
                <span>Purchase Order</span>
            </div>
            <div class="row ml-auto w-100">
                <div class="col-7 text-left mb4 p-0" style="border:2px solid black;">
                    <div t-if="'Ecartes' in o.company_id.name" style="background-color:#6d3473; color:white"> TO</div>
                    <div t-if="'Salvonic' in o.company_id.name" style="background-color:#25a7dd; color:white"> TO</div>
                    <div style="font-weight:bold;text-align:left;"> <span t-if="o.partner_id.name"><t t-esc="o.partner_id.name"/></span></div>
                    <div style="text-align:left;">
                         <span t-if="o.partner_id.street"><t t-esc="o.partner_id.street"/></span>,<span t-if="o.partner_id.street2"><t t-esc="o.partner_id.street2"/></span>
                    </div>
                    <div style="text-align:left;"> <span t-if="o.partner_id.city"><t t-esc="o.partner_id.city"/></span>, <span t-if="o.partner_id.street"><t t-esc="o.partner_id.state_id.name"/></span>-<span t-if="o.partner_id.zip"><t t-esc="o.partner_id.zip"/></span></div>
                    <div style="width:100%;float:left;display:flex;border-top:2px solid black;">
                        <div style="float:left;text-align:left;" t-if="o.partner_id.gstin">
                             GSTIN: <span t-if="o.partner_id.gstin"><t t-esc="o.partner_id.gstin"/></span>
                        </div>
                    </div>
                </div>
                <div class="col-5"></div>
            </div>
            <!-- <div class="oe_structure"/> -->

            <!-- <h2 t-if="o.state in ['draft', 'sent', 'to approve']">Request for Quotation #<span t-field="o.name"/></h2>
            <h2 t-if="o.state in ['purchase', 'done']">Purchase Order #<span t-field="o.name"/></h2>
            <h2 t-if="o.state == 'cancel'">Cancelled Purchase Order #<span t-field="o.name"/></h2> -->

            <div id="informations" class="row mt32 mb32 d-none">
                <div t-if="o.user_id" class="col-3 bm-2">
                    <strong>Purchase Representative:</strong>
                    <p t-field="o.user_id" class="m-0"/>
                </div>
                <div t-if="o.partner_ref" class="col-3 bm-2">
                    <strong>Your Order Reference:</strong>
                    <p t-field="o.partner_ref" class="m-0"/>
                </div>
                <div t-if="o.date_order" class="col-3 bm-2">
                    <strong>Order Date:</strong>
                    <p t-field="o.date_order" class="m-0"/>
                </div>
            </div>

            <table class="mt-3" style="font-size:15px;border: 2px solid black !important;" >
                <style>
                    th,td{ border: 2px solid black !important; padding:5px; }
                </style>

                <thead t-if="'Ecartes' in o.company_id.name" style="background-color:#6d3473; color:white">
                    <tr>
                        <th class="text-center" style="width:8%">S.No.</th>
                        <th  class="text-center" style="width:25%">Product Name</th>
                        <th class="text-center" style="width:25%">Description</th>
                        <th  class="text-center" style="width:10%">QTY</th>
                        <th  class="text-center" style="width:12%">Unit Price</th>
                        <th class="text-center" style="width:20%">Sub-Total</th>
                    </tr>
                </thead>
                <thead t-if="'Salvonic' in o.company_id.name" style="background-color:#25a7dd; color:white">
                    <tr>
                        <th class="text-center" style="width:8%">S.No.</th>
                        <th  class="text-center" style="width:25%">Product Name</th>
                        <th class="text-center" style="width:25%">Description</th>
                        <th  class="text-center" style="width:10%">QTY</th>
                        <th  class="text-right" style="width:12%">Unit Price</th>
                        <th class="text-right" style="width:20%">Sub-Total</th>
                    </tr>
                </thead>
                <tbody class="po_tbody" style="font-size:15px;">
                    <t t-set="sr_no" t-value="0"/>
                    <t t-foreach="o.order_line" t-as="line">
                        <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''" class="border-black" style="border-bottom:1px solid #dddddd;">
                            <t t-if="not line.display_type">
                                <t t-set="sr_no" t-value="sr_no+1"/>
                                <td class="text-center" style="border:1px solid black"><span t-esc="sr_no"/></td>
                                <td id="product" class="text-center"><span t-field="line.product_id.name"/></td>
                                <td class="text-center"><span t-field="line.name"/></td>
                                <td  class="text-center"><span t-field="line.product_qty"/></td>
                                <td  class="text-right"><span><span t-field="line.price_unit" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/></span></td>
                                <td class="text-right"><span t-field="line.price_subtotal"/></td>
                            </t>
                        </tr>
                    </t>
                    <tr><td colspan="6"> </td></tr>
                    <t t-set="tax_totals" t-value="o.tax_totals"/>
                    <t t-if="tax_totals['subtotals']">
                        <t t-foreach="tax_totals['subtotals']" t-as="subtotal">
                            <tr class="border-black o_subtotal">
                                <td class="text-right" colspan="5">
                                    <strong><span class="mr-1">Total</span></strong>
                                </td>
                                <td class="text-right">
                                    <span t-att-class="oe_subtotal_footer_separator" t-esc="subtotal['base_amount_currency']" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                            </tr>
                            <t t-set="subtotal_to_show" t-value="subtotal['name']"/>
                            <t t-foreach="o.order_line.mapped('taxes_id')" t-as="tax">
                                <t t-if="tax.amount_type == 'group'">
                                    <tr t-foreach="tax.children_tax_ids" t-as="tax_line">
                                        <td class="text-right" colspan="5">
                                            <strong><span class="mr-1" t-esc="tax_line.description"/> </strong>
                                        </td>
                                        <td style="text-align:right;">
                                            <t t-if="tax_line.tax_group_id.name == 'SGST'">
                                                ₹
                                                <span t-esc="'{:,.2f}'.format((sum((o.order_line.filtered(lambda line: tax_line in line.mapped('taxes_id').mapped('children_tax_ids'))).mapped('price_subtotal')) * tax_line.amount / 100))"/>
                                            </t>
                                            <t t-if="tax_line.tax_group_id.name == 'CGST'">
                                                ₹
                                                <span t-esc="'{:,.2f}'.format((sum((o.order_line.filtered(lambda line: tax_line in line.mapped('taxes_id').mapped('children_tax_ids'))).mapped('price_subtotal')) * tax_line.amount / 100))"/>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                                <t t-else="">
                                    <tr>
                                        <td class="text-right" colspan="5">
                                            <strong><span class="mr-1" t-esc="tax.description"/> </strong>
                                        </td>
                                        <td style="text-align:right;">
                                            <t t-if="tax.tax_group_id.name == 'SGST'">
                                                ₹ <span t-esc="'{:,.2f}'.format((sum((o.order_line.filtered(lambda line: tax in line.mapped('taxes_id').mapped('children_tax_ids'))).mapped('price_subtotal')) * tax.amount / 100))"/>
                                            </t>
                                            <t t-if="tax.tax_group_id.name == 'CGST'">
                                                ₹ <span t-esc="'{:,.2f}'.format((sum((o.order_line.filtered(lambda line: tax in line.mapped('taxes_id').mapped('children_tax_ids'))).mapped('price_subtotal')) * tax.amount / 100))"/>
                                            </t>
                                            <t t-if="tax.tax_group_id.name == 'IGST'">
                                                ₹ <span t-esc="'{:,.2f}'.format((sum((o.order_line.filtered(lambda line: tax in line.mapped('taxes_id'))).mapped('price_subtotal')) * tax.amount / 100))"/>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </t>
                            <tr class="border-black o_total">
                                <td class="text-right" colspan="5">
                                    <strong><span class="mr-1">Total Amount</span></strong>
                                </td>
                                <td class="text-right">
                                    <strong t-esc="tax_totals['total_amount_currency']" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                            </tr>
                        </t>
                    </t>
                    <t t-else="">
                        <tr class="border-black o_subtotal">
                            <td class="text-right" colspan="5">
                                <strong><span class="mr-1">Total</span></strong>
                            </td>
                            <td class="text-right">
                                <span t-att-class="oe_subtotal_footer_separator" t-field="o.amount_untaxed" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </td>
                        </tr>
                        <tr class="border-black o_total">
                            <td class="text-right" colspan="5">
                                <strong><span class="mr-1">Total Amount</span></strong>
                            </td>
                            <td class="text-right">
                                <span t-field="o.amount_total" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </td>
                        </tr>
                    </t>
                    <tr><td colspan="6"> </td></tr>
                    <tr><td colspan="6" class="text-center"><strong>Our GSTIN Number : <t t-esc="company_id_val.vat"/></strong></td></tr>
                    <tr><td colspan="6"> </td></tr>
                    <tr t-if="'Ecartes' in o.company_id.name" style="background-color:#6d3473; color:white"><td colspan="6"><strong>TERMS &amp; CONDITIONS</strong></td></tr>
                    <tr t-if="'Salvonic' in o.company_id.name" style="background-color:#25a7dd; color:white"><td colspan="6"><strong>TERMS &amp; CONDITIONS</strong></td></tr>
                    <tr><td colspan="6"> </td></tr>
                    <tr>
                        <td colspan="6">
                            <div t-if="o.payment_term_id">Payment: <span t-field="o.payment_term_id"/></div>
                            <div t-if="o.date_planned"><strong>Delivery: By <span t-field="o.date_planned" t-options="{'widget': 'datetime', 'date_only': 'true', 'format': 'MMMM d, yyyy'}"/></strong></div>
                            <div>All commercial invoices should carry relevant HSN/SAC code &amp; GST Number as applicable.</div><br/>
                            <div t-if="o.notes"><p t-field="o.notes"/> </div>
                            <div class="w-100">
                                <div style="width:100%">
                                    <div><strong><span style="text-decoration: underline;">Ship To:-</span></strong><span t-field="o.picking_type_id.warehouse_id.partner_id" t-options='{"widget": "contact", "fields": ["address", "name", "phone", "email"], "no_marker": True, "phone_icons": True}'/></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- <div style="width:100%;float:left;text-align:left;margin-top: 0px;page-break-inside: avoid;font-size:15px;">
                <div>
                    <div t-if="o.validity_date"><b >Validity : </b><t t-esc="o.validity_date"/></div>
                    <div t-if="o.payment_term_id.name"><b >Payment Terms : </b><t t-esc="o.payment_term_id.name"/></div>
                    <div t-if="o.note"><t t-esc="o.note"/></div>                            
                    <div>
                        <p id="fiscal_position_remark"
                        t-if="o.fiscal_position_id and not is_html_empty(o.fiscal_position_id.sudo().note)">
                        <strong>Fiscal Position Remark:</strong>
                        <span t-field="o.fiscal_position_id.sudo().note"/>
                    </p>
                    </div>
                </div>
                <div>
                        <b>Terms and Condition : </b>
                </div>
                <div style="width:100%;float:left;text-align:left;margin-top: 15px;font-size:15px;">
                    <div>Consumables subject to wear-and-tear are not covered by the warranty</div>
                    <div>No claims regarding consequential loss of any kind or nature whatsoever will be accepted by Ecartes Technology Pvt. Ltd.</div>
                    <div>Warranty automatically gets void in case of wrong use of the machinery or use of fake or pirated consumables</div>
                </div> 
            </div> -->

           <!--  <table class="table table-sm o_main_table">
                <thead>
                    <tr>
                        <th name="th_description"><strong>Description</strong></th>
                        <th name="th_taxes"><strong>Taxes</strong></th>
                        <th name="th_date_req" class="text-center"><strong>Date Req.</strong></th>
                        <th name="th_quantity" class="text-right"><strong>Qty</strong></th>
                        <th name="th_price_unit" class="text-right"><strong>Unit Price</strong></th>
                        <th name="th_amount" class="text-right"><strong>Amount</strong></th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="current_subtotal" t-value="0"/>
                    <t t-foreach="o.order_line" t-as="line">
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                        <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                            <t t-if="not line.display_type">
                                <td id="product">
                                    <span t-field="line.name"/>
                                </td>
                                <td name="td_taxes">
                                    <span t-esc="', '.join(map(lambda x: x.name, line.taxes_id))"/>
                                </td>
                                <td class="text-center">
                                    <span t-field="line.date_planned"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="line.product_qty"/>
                                    <span t-field="line.product_uom.name" groups="uom.group_uom"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="line.price_unit"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="line.price_subtotal"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                            </t>
                            <t t-if="line.display_type == 'line_section'">
                                <td colspan="99" id="section">
                                    <span t-field="line.name"/>
                                </td>
                                <t t-set="current_section" t-value="line"/>
                                <t t-set="current_subtotal" t-value="0"/>
                            </t>
                            <t t-if="line.display_type == 'line_note'">
                                <td colspan="99" id="note">
                                    <span t-field="line.name"/>
                                </td>
                            </t>
                        </tr>
                        <t t-if="current_section and (line_last or o.order_line[line_index+1].display_type == 'line_section')">
                            <tr class="is-subtotal text-right">
                                <td colspan="99" id="subtotal">
                                    <strong class="mr16">Subtotal</strong>
                                    <span
                                        t-esc="current_subtotal"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                                    />
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>
            </table>

            <div id="total" class="row justify-content-end">
                <div class="col-4">
                    <table class="table table-sm">
                        <t t-set="tax_totals" t-value="o.tax_totals"/>
                        <t t-call="account.document_tax_totals"/>
                    </table>
                </div>
            </div> -->

            <!-- <p t-field="o.notes"/>
            <div class="oe_structure"/> -->
        </div>
    </t>
</template>


<template id="report_purchaseorder_document_stock_inherit" inherit_id="purchase_stock.report_purchaseorder_document">
    <xpath expr="//t[@t-set='information_block']" position="attributes">
        <attribute name="class">d-none</attribute>
    </xpath>
</template>


</odoo>
